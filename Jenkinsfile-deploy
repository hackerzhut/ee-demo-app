node("docker-deploy") {
    git url: "https://github.com/ollypom/ee-demo-app.git", credentialsId: 'd3f7ca2b-c6e7-464c-9723-e90f4bbacaf7'

    sh "git rev-parse HEAD > .git/commit-id"
    def commit_id = readFile('.git/commit-id').trim()
    println commit_id
    
    stage "deploy"
    sh "export DOCKER_TLS_VERIFY=1 \
    DOCKER_HOST=tcp://52.56.242.202:443 \
    DOCKER_CERT_PATH=/ && \
    docker service update --image 52.56.228.3/admin/demo-app:${commit_id} Demo_webapp"
}
