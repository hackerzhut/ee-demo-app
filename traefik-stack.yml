version: '3.2'
services:
    traefik:
        image: 52.56.228.3/admin/traefik:latest
        command: --web --docker --docker.swarmmode --docker.watch --docker.domain=traefik --logLevel=DEBUG
        ports:
            - "80:80"
            - "8080:8080"
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - /dev/null:/traefik.toml
        labels:
            - "traefik.enable=false"
        networks:
            - public
        deploy:
             replicas: 1
             placement:
                constraints: [node.role == manager]
             restart_policy:
                condition: on-failure
    web:
        image: 52.56.228.3/admin/demo-app:latest
        networks: public
        deploy:
            mode: replicated
            replicas: 1
            labels:
                - "traefik.backend=http"
                - "traefik.port=80"
                - "traefik.frontend.rule=PathPrefixStrip:/http/"
                - "traefik.docker.network=traefik_public"
        ports:
            - 30001:80

networks:
    public:
        driver: overlay
